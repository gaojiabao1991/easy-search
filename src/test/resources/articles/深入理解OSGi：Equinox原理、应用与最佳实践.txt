
       深入理解   OSGi：
Equinox 原理、应用与最佳实践

         周志明　谢小明   著
图书在版编目（CIP）数据

深入理解     OSGi：Equinox    原理、应用与最佳实践             / 周志明，谢小明著         . —北京：机械工业出版社，2013.1

ISBN 978-7-111-40887-1

I. 深…　II.  ① 周…　② 谢…　III. JAVA        语言－程序设计　IV. TP312

中国版本图书馆         CIP 数据核字（2012）第           302863 号

版权所有·侵权必究
封底无防伪标均为盗版
本书法律顾问　北京市展达律师事务所

      本书是原创       Java 技术图书领域继《深入理解                Java 虚拟机》后的又一实力之作，也是全球首本基
于最新    OSGi R5.0  规范的著作。理论方面，既全面解读了                       OSGi  规范，深刻揭示了           OSGi 原理，详细讲
解了   OSGi  服务，又系统地介绍了             Equinox  框架的使用方法，并通过源码分析了该框架的工作机制；实
践方面，不仅包含一些典型的案例，还总结了大量的最佳实践，极具实践指导意义。
      全书共    14 章，分     4 个部分。第一部分（第             1 章）：走近      OSGi，主要介绍了什么是              OSGi  以及为
什么要使用       OSGi。第二部分（第           2 ～  4 章）：OSGi     规范与原理，对最新的              OSGi  R5.0 中的核心规范
进行了全面的解读，首先讲解了                   OSGi  模块的建立、描述、依赖关系的处理，然后讲解了                             Bundle  的启
动原理和调度管理，最后讲解了与本地及远程服务相关的内容。第三部分                                         ：OSGi    服务与    Equinox  应用
实践（第      5 ～ 11 章），不仅详细讲解了             OSGi  服务纲要规范和企业级规范中最常用的几个子规范和服
务的技术细节，还通过一个基于                   Equinox 的  BBS  案例演示了       Equinox  的使用方法，最重要的是还通过
源码分析了       Equinox 关键功能的实现机制和原理。第四部分                       ：最佳实践（第         12 ～  14 章），总结了大量
关于   OSGi  的最佳实践，包括从            Bundle  如何命名、模块划分、依赖关系处理到保持                          OSGi  动态性、管
理程序启动顺序、使用             API  基线管理模块版本等各方面的实践技巧，此外还介绍了                                Spring DM  的原理
以及如何在       OSGi  环节中进行程序测试。


机械工业出版社（北京市西城区百万庄大街                         22 号　　邮政编码　100037）
责任编辑 ：孙海亮
　　　　　　　　　　　印刷
2013 年  2 月第   1 版第  1 次印刷
186mm×240mm • 27     印张
标准书号： ISBN 978-7-111-40887-1
定　　价：79.00       元

凡购本书，如有缺页、倒页、脱页，由本社发行部调换
客服热线：（010）88378991　88361066                    投稿热线：（010）88379604
购书热线：（010）68326294　88379649　68995259           读者信箱：hzjsj@hzbook.com
                                     前　　言


为什么写这本书

    随着软件规模的日益增大，程序按模块拆分、按模块开发和按模块部署等需求变得越来
越迫切，“模块化”成为了             Java 社区中最热门的话题之一。而                OSGi 技术—Java      业界事实
上的模块化标准，也被越来越多的中间件、第三方类库和各类应用程序所认可和采用。与此
相对的是，有关        OSGi  技术的资料，尤其是中文的资料却显得异常的贫乏。
    笔者自    2007 年接触    OSGi  以来，曾在数个大型系统中使用过                   OSGi 作为软件的基础架
构，这一方面使笔者深刻感受到了                  OSGi 带来的诸多好处以及           OSGi  设计思想的魅力        ；另一
方面也使笔者注意到           OSGi 的入门门槛相对较高，如果没有足够的指导材料，开发人员从零
开始学习并探索出         OSGi  的最佳实践需要很高的成本。因此，笔者就萌生了写一本关于                               OSGi
原理、应用与最佳实践的中文书籍的想法。
    自从   1999 年 OSGi  联盟成立以来，OSGi          技术随着     Java 一起飞速发展，现已经成为一
种被广泛认可的软件架构技术和方法。OSGi                     联盟的成员数量也已经从最开始的几个增长到
目前的    100 多个，许多世界著名的             IT 企业都加入到        OSGi 的阵营之中，如          Adobe、IBM、
Oracle、SAP、RedHat    和  Siemens 等。这些软件厂商推出的许多产品都支持                      OSGi 技术，甚
至产品本身就使用了            OSGi 技术构建，例如          IBM 的  WebSphere、Lotus   和 JAZZ，Oracle   的
GlassFish 和 Weblogic，RedHat  的  JBoss，Eclipse 基金会的      Eclipse IDE、Equinox  及之下的
众多子项目，Apache        基金会的     Karaf、Aries、Geronimo、Felix    及之下的众多子项目等。这
些业界巨头的踊跃参与，从侧面证明了                   OSGi  技术有着非常广阔的市场前景。
    OSGi  能获得如此广泛的认可，一方面是它的诞生迎合了软件模块化的需求                                   ；另一方面
是因为它足够全面和开放，OSGi               所具有的动态性、伸缩性正好是许多生产系统所需的。基
于 OSGi  的程序更新升级或者缺陷修复，能够像电脑更换                        USB  接口的鼠标键盘或者插拔其他
USB 设备那样可以即插即用，无须重启，甚至无须停顿，这是许多基于                                  Java 的、需要    7×24
小时运转的生产系统长期以来迫切希望而又无法实现的需求。把软件开发中公用的、通用的
功能抽象成标准件，令各个软件可以使用同样的模块来完成特定需求，把软件开发变为搭建
模块，这更是软件工业化的最终理想，而                     OSGi 为这个目标带来了实现的曙光。
    目前，虽然      OSGi  背后有庞大的厂商支持，对实现框架、中间件和类库的支撑也足够完
善，但是在国内基于           OSGi 架构的系统还不是很多。很多软件企业都跃跃欲试，尝试迈出使
IV

用 OSGi  的第一步，但往往被其复杂性阻挡于大门之外—如果要用                                OSGi  开发一个入门程
序，并不需要多高深的知识，但如果要把                     OSGi  运用于生产系统，则要求该软件系统的架构
师和至少一部分中高级开发人员必须对                    OSGi  有比较深入的了解，业界对这一部分人才的需
求也一直非常大。通过本书，读者可以通过一个相对轻松的方式学习到                                     OSGi  的运作原理，
这对自身能力的提高有较大的帮助。

本书面向的读者

    1. 系统架构师
    OSGi  目前已经成为互联网、桌面程序、移动设备和企业级应用等领域中最流行的系统
架构方法之一，OSGi         本身的设计思想也非常值得系统架构师借鉴。
    2. 使用   Java 技术体系的中、高级开发人员
    鉴于   OSGi 技术本身的复杂性和相对陡峭的学习曲线，开发人员入门和深入理解                                     OSGi
时要付出较多的努力，本书的理论讲解和案例实践将帮助对                               OSGi 感兴趣的开发人员跨过初
学 OSGi  的那道门槛。
    3. 系统运维工程师
    保障系统的性能，更新和维护程序版本是系统运维工程师的主要职责。目前                                    Java 业界主流
的中间件均开始直接支持甚至基于                 OSGi 架构实现。伴随        OSGi 的发展，越来越多使用            OSGi 技
术的程序被部署到生产系统之中，OSGi                 已经成为一个优秀的运维工程师必须了解的专业知识。
本书中的大量案例、代码、调优实战将会对系统运维工程师日常的工作起到直接的参考作用。

如何阅读本书

    本书一共分为        4 个部分   ：走近    OSGi、OSGi    规范与原理、基于         Equinox 的  OSGi 应用与
实践、最佳实践。各个部分之间基本上是互相独立的，没有必然的前后依赖关系，读者可以
从任何一个感兴趣的专题开始阅读，但是每个部分中的各个章节间会有先后顺序。
    本书并不要求读者在           Java 领域具备很高的技术水平，而且在讲解各个知识点时会在保
证逻辑准确的前提下、尽量用通俗的语言和案例去讲述                           OSGi  中与开发关系最为密切的内容；
但是由于探讨       OSGi  过程中涉及的许多问题不可避免地需要读者有一定技术基础，因此本书
的定位依然是面向中、高级的程序员群体，对于一些常用的开发框架、Java API、Java                                      语法
等基础知识点，将认为读者已有所了解。
    下面简要介绍一下本书各部分的内容。
    第一部分　走近         OSGi
    本书第一部分为后文的研究和讲解打下了基础，让读者了解                               OSGi 的来龙去脉以及它出
现的意义，这是走近          Java 技术和    Java 虚拟机的第一步。第一部分包括第                 1 章：
